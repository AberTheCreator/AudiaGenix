<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AudiaGenix Demo</title>
  <style>
    body {
      font-family: sans-serif;
      color: white;
      background: linear-gradient(135deg, hsl(184, 85%, 39%) 0%, hsl(258, 84%, 67%) 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 2rem;
    }
    #transcript {
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(8px);
      border-radius: 0.5rem;
      padding: 1rem;
      max-width: 600px;
      margin-top: 1rem;
      white-space: pre-wrap;
    }
    button {
      background: white;
      color: black;
      padding: 0.5rem 1rem;
      margin: 0.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    input[type="file"] {
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>üé§ AudiaGenix Demo</h1>
  <input type="file" id="audioFile" accept="audio/*" />
  <button onclick="transcribeSelectedFile()">Transcribe Audio</button>
  <div id="transcript">Upload an audio file to transcribe.</div>

  <script>
    const apiKey = 'e2d8b4e9e28341d884ae24f0c42d753b';

    async function transcribeSelectedFile() {
      const fileInput = document.getElementById('audioFile');
      const transcriptDiv = document.getElementById('transcript');

      if (!fileInput.files.length) {
        alert('Please select an audio file first.');
        return;
      }

      const file = fileInput.files[0];
      transcriptDiv.innerText = 'Uploading...';

      try {
        // 1Ô∏è‚É£ Upload file
        const uploadRes = await fetch('https://api.assemblyai.com/v2/upload', {
          method: 'POST',
          headers: { 'authorization': apiKey },
          body: file
        });
        const uploadData = await uploadRes.json();
        const audioUrl = uploadData.upload_url;

        transcriptDiv.innerText = 'Processing transcription...';

        // 2Ô∏è‚É£ Start transcription
        const transcriptRes = await fetch('https://api.assemblyai.com/v2/transcript', {
          method: 'POST',
          headers: {
            'authorization': apiKey,
            'content-type': 'application/json'
          },
          body: JSON.stringify({
            audio_url: audioUrl,
            speaker_labels: true,
            auto_highlights: true,
            sentiment_analysis: true,
            entity_detection: true,
            punctuate: true,
            format_text: true
          })
        });
        const transcriptData = await transcriptRes.json();
        const transcriptId = transcriptData.id;

        // 3Ô∏è‚É£ Poll for completion
        let completed = false;
        while (!completed) {
          await new Promise(res => setTimeout(res, 2000)); // wait 2 sec
          const pollingRes = await fetch(`https://api.assemblyai.com/v2/transcript/${transcriptId}`, {
            headers: { 'authorization': apiKey }
          });
          const pollingData = await pollingRes.json();
          if (pollingData.status === 'completed') {
            transcriptDiv.innerText = `‚úÖ Transcription complete:\n\n${pollingData.text}`;
            completed = true;
          } else if (pollingData.status === 'error') {
            transcriptDiv.innerText = `‚ùå Error: ${pollingData.error}`;
            completed = true;
          } else {
            transcriptDiv.innerText = `‚è≥ Status: ${pollingData.status}...`;
          }
        }
      } catch (err) {
        console.error(err);
        transcriptDiv.innerText = '‚ùå Failed to transcribe audio.';
      }
    }
  </script>
</body>
</html>
